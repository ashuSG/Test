function startAlertsPoller(e){!function t(){getActiveAlerts(),getAlertsLog(),setTimeout(t,e)}()}function getActiveAlerts(t){var e={UserPoolId:localStorage.getItem("upId"),ClientId:localStorage.getItem("clientId")},o="https://"+id+".execute-api.ap-southeast-1.amazonaws.com/"+stage+"/Alarms/get-active-alerts",n=new AWSCognito.CognitoIdentityServiceProvider.CognitoUserPool(e).getCurrentUser();null!=n&&n.getSession(function(t,e){t?console.dir(t):$.ajax({type:"POST",url:o,crossDomain:!0,headers:{"Content-Type":"application/json",Authorization:e.getIdToken().getJwtToken()},data:JSON.stringify({project_name:localStorage.getItem("current_project"),device_name:localStorage.getItem("current_device")}),dataType:"json",contentType:"application/json",success:function(t){json=$.parseJSON(t);for(var e,o={weekday:"long",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"},n=$(),a=0;a<json.length;a++)e=$("<tr/>"),formattedTime=getformatedTime(json[a].time,o),e.append("<td>"+formattedTime+"</td>"),e.append("<td>"+json[a].alert+"</td>"),e.append("<td>"+json[a].state+"</td>"),e.append("<td>"+json[a].priority+"</td>"),e.append("<td id=alert"+json[a].id+"><button onclick='acknowledgeAlert(\""+json[a].id+"\")' id='alert-btn-"+json[a].id+"' type='button' class='btn btn-primary' data-loading-text='<i class=\"fa fa-circle-o-notch fa-spin\"></i> Loading...'>Acknowledge</button></td>"),n=n.add(e);$("#activeAlertsList").html(n)}})})}function getAlertsLog(t){var e={UserPoolId:localStorage.getItem("upId"),ClientId:localStorage.getItem("clientId")},o="https://"+id+".execute-api.ap-southeast-1.amazonaws.com/"+stage+"/Alarms/get-logged-alerts",n=new AWSCognito.CognitoIdentityServiceProvider.CognitoUserPool(e).getCurrentUser();null!=n&&n.getSession(function(t,e){t?console.dir(t):$.ajax({type:"POST",url:o,crossDomain:!0,headers:{"Content-Type":"application/json",Authorization:e.getIdToken().getJwtToken()},data:JSON.stringify({project_name:localStorage.getItem("current_project"),device_name:localStorage.getItem("current_device")}),dataType:"json",contentType:"application/json",success:function(t){json=$.parseJSON(t);for(var e,o={weekday:"long",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"},n=(new Date(0),$()),a=0;a<json.length;a++){e=$("<tr/>");var r=getformatedTime(json[a].event_time,o),i=getformatedTime(json[a].timestamp,o);e.append("<td>"+r+"</td>"),e.append("<td>"+json[a].alert+"</td>"),e.append("<td>"+json[a].state+"</td>"),e.append("<td>"+json[a].priority+"</td>"),e.append("<td>"+i+"</td>"),n=n.add(e)}$("#alertsLog").html(n)}})})}function getformatedTime(t,e){return new Date(1e3*t).toLocaleTimeString("en-us",e)}function acknowledgeAlert(o){var t=new AWSCognito.CognitoIdentityServiceProvider.CognitoUserPool(poolData).getCurrentUser();null!=t&&t.getSession(function(t,e){t?console.dir(t):$.ajax({type:"POST",url:"https://xst0w6o6q2.execute-api.ap-southeast-1.amazonaws.com/dev/Alarms/acknowledge-alerts",crossDomain:!0,headers:{"Content-Type":"application/json",Authorization:e.getIdToken().getJwtToken()},data:JSON.stringify({project_name:localStorage.getItem("current_project"),device_name:localStorage.getItem("current_device"),id:o}),dataType:"json",contentType:"application/json",success:function(t){$("#alert-btn-"+o).button("loading")}})})}